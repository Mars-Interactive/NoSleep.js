/*! main.js v0.12.23 - git.io/vfn01 - AnaneyTech - MIT license */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NoSleep=t():e.NoSleep=t()}(this,()=>(()=>{"use strict";var e={r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function i(e,t,i,o,n,a,l){try{var r=e[a](l),s=r.value}catch(e){return void i(e)}r.done?t(s):Promise.resolve(s).then(o,n)}function o(e){return function(){var t=this,o=arguments;return new Promise(function(n,a){var l=e.apply(t,o);function r(e){i(l,n,a,r,s,"next",e)}function s(e){i(l,n,a,r,s,"throw",e)}r(void 0)})}}function n(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}e.r(t);var{webm:a,mp4:l}=require("./media.js");return module.exports=class{constructor(){var e,t=this,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n(this,"_wakeLock",null),n(this,"_isNativeSupported",(e=/ipad|iphone|ipod/i.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,"wakeLock"in navigator&&!e)),n(this,"_noSleepVideo",null),n(this,"_handleVisibilityChange",()=>{null!==this._wakeLock&&"visible"===document.visibilityState&&this.enable()}),n(this,"_handleMp4TimeUpdate",()=>{this._noSleepVideo&&this._noSleepVideo.currentTime>.5&&(this._noSleepVideo.currentTime=.1*Math.random())}),n(this,"enable",o(function*(){if(t._isNativeSupported){if(t._wakeLock)return;try{t._wakeLock=yield navigator.wakeLock.request("screen"),t._wakeLock.addEventListener("release",()=>{t._wakeLock=null,t.enabled=!1,console.warn("Wake Lock released by browser.")}),t.enabled=!0,console.info("Wake Lock active.")}catch(e){t.enabled=!1,console.warn("NoSleep failed to activate WakeLock: ".concat(e.message))}}else if(t._noSleepVideo)try{yield t._noSleepVideo.play(),t.enabled=!0}catch(e){t.enabled=!1,console.warn("NoSleep failed to play Video: ".concat(e.message))}})),n(this,"disable",()=>{this._isNativeSupported?this._wakeLock&&(this._wakeLock.release().then(()=>{this._wakeLock=null}),console.info("Wake Lock released.")):this._noSleepVideo&&this._noSleepVideo.pause(),this.enabled=!1}),this.enabled=!1,i&&this._isNativeSupported?(document.addEventListener("visibilitychange",this._handleVisibilityChange),document.addEventListener("fullscreenchange",this._handleVisibilityChange),console.debug("Native Wake Lock API selected.")):(this._isNativeSupported=!1,this._setupVideoFallback())}_setupVideoFallback(){var e;this._noSleepVideo=document.createElement("video"),this._noSleepVideo.setAttribute("title","No Sleep"),this._noSleepVideo.setAttribute("playsinline",""),this._noSleepVideo.muted=!0,this._addSourceToVideo(this._noSleepVideo,"webm",a),this._addSourceToVideo(this._noSleepVideo,"mp4",l),Object.assign(this._noSleepVideo.style,{position:"absolute",left:"-100%",top:"-100%"}),null===(e=document.body)||void 0===e||e.append(this._noSleepVideo),this._noSleepVideo.addEventListener("loadedmetadata",()=>{this._noSleepVideo.duration>1?this._noSleepVideo.addEventListener("timeupdate",this._handleMp4TimeUpdate):this._noSleepVideo.setAttribute("loop","")})}_addSourceToVideo(e,t,i){var o=document.createElement("source");o.src=i,o.type="video/".concat(t),e.appendChild(o)}get isEnabled(){return this.enabled}},t})());